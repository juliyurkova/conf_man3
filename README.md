# Домашнее задание 3 конфигурационное управление
## Вариант 31
### Задание 3
Разработать инструмент командной строки для учебного конфигурационного 
языка, синтаксис которого приведен далее. Этот инструмент преобразует текст из 
входного формата в выходной. Синтаксические ошибки выявляются с выдачей 
сообщений. 
Входной текст на учебном конфигурационном языке принимается из 
файла, путь к которому задан ключом командной строки. Выходной текст на 
языке toml попадает в стандартный вывод. 

Словари: 

@{ 

имя = значение; 

имя = значение; 

имя = значение; 

... 

} 

Имена: 

`[a-zA-Z][a-zA-Z0-9]*`

Значения: 
- Числа. 
- Строки. 
- Словари.

Строки: 
`[[Это строка]]`

Объявление константы на этапе трансляции: 
`def имя := значение`

Вычисление константного выражения на этапе трансляции (префиксная 
форма), пример: 

`#(+ имя 1)`

Результатом вычисления константного выражения является значение. 
Для константных вычислений определены операции и функции: 
1. Сложение. 
2. Вычитание. 
3. Умножение. 
4. chr().

Все конструкции учебного конфигурационного языка (с учетом их 
возможной вложенности) должны быть покрыты тестами. Необходимо показать 3 
примера описания конфигураций из разных предметных областей. 
### Общее описание
Программа выполняет разбор пользовательского конфигурационного файла со сложным синтаксисом, преобразует его данные в формат TOML и выводит результат. 

Основные шаги:
1. Чтение конфигурационного файла, содержащего константы, блоки данных и выражения.
2. Разбор содержимого с помощью класса **`ConfigParser`**:
   - Определение констант и их вычисление.
   - Обработка пар ключ-значение и блоков данных.
   - Обработка арифметических выражений и ссылок на константы.
3. Преобразование разобранных данных в TOML-формат с помощью библиотеки **`toml`**.
4. Вывод результата или сообщений об ошибках (синтаксические, файл не найден и т. д.).

Программа предназначена для автоматизации преобразования сложных конфигурационных файлов в универсальный формат.
### Описание класса SyntaxError
Класс **`SyntaxError`** — пользовательское исключение, используемое для обозначения синтаксических ошибок при разборе конфигурационного файла.
### Описание класса ConfigParser
Класс отвечает за разбор и преобразование конфигурационного файла
### Описание метода __init__
Метод **`__init__`** инициализирует объект класса, создавая пустой словарь **`self.constants`** для хранения объявленных констант и их значений.
### Описание метода parse
Метод **`parse`** выполняет разбор входного текста: 
- Обрабатывает строки, игнорируя пустые и комментарии. 
- Определяет константы, блоки данных и пары ключ-значение.
- Структурирует данные в словарь **`parsed_data`**, создавая уникальные имена для блоков данных.
### Описание метода _parse_constant
Метод **`_parse_constant`** обрабатывает строки, определяющие константы, в формате `def имя := значение`. С помощью регулярного выражения он извлекает имя константы и соответствующее выражение для значения. Затем выражение обрабатывается (удаляются лишние переносы строк) и вычисляется с помощью метода **`_evaluate_expression`**. Полученное значение сохраняется в словарь **`self.constants`** с ключом — именем константы.
### Описание метода _evaluate_expression
Метод **`_evaluate_expression`** выполняет вычисление выражений. Он поддерживает несколько типов выражений:
1. Преобразует строковые числовые выражения в целые числа.
2. Обрабатывает выражения вида `chr(n)`, возвращая символ, соответствующий числу.
3. Выполняет арифметические операции, такие как сложение, вычитание, умножение и деление, для выражений вида `#(операция левый_операнд правый_операнд)`.
4. Также поддерживает операции с одним операндом, например `#(- 5)`.

В случае некорректных выражений выбрасывает исключение `SyntaxError`.
### Описание метода _get_value_from_expression
Метод **`_get_value_from_expression`** извлекает значения операндов из выражений. Он выполняет следующие действия:
1. Если операнд — это число, он преобразует его в тип `int` и возвращает.
2. Если операнд — это имя константы, он возвращает соответствующее значение из словаря `constants`.
3. В случае, если операнд не является числом или известной константой, выбрасывает исключение `SyntaxError`.
### Описание метода _parse_key_value
Метод **`_parse_key_value`** обрабатывает строку в формате "ключ = значение;". Он выполняет следующие шаги:
1. С помощью регулярного выражения находит пары "ключ = значение".
2. Если строка не соответствует формату, выбрасывает исключение `SyntaxError`.
3. Извлекает ключ и значение, затем преобразует значение с помощью метода `_parse_value`.
4. Возвращает ключ и преобразованное значение.
### Описание метода _parse_value
Метод **`_parse_value`** обрабатывает значение в паре "ключ = значение". Он выполняет следующие действия:
1. Если значение — это целое число, преобразует его в `int`.
2. Если значение — это число с плавающей точкой, преобразует его в `float`.
3. Если значение заключено в двойные квадратные скобки `[[...]]`, удаляет скобки и возвращает строку.
4. Если значение является именем константы, возвращает соответствующее значение из словаря `constants`.
5. Если значение не соответствует ни одному из этих типов, выбрасывает исключение `SyntaxError`.
### Описание метода _generate_dict_name
Метод **`_generate_dict_name`** генерирует уникальное имя для нового словаря. Он проверяет, существует ли уже в словаре `parsed_data` имя вида `dict1`, `dict2` и так далее. Если имя занято, инкрементирует индекс и повторяет проверку, пока не находит свободное имя, которое и возвращает.
### Описание функции main
Функция **`main`** выполняет обработку аргументов командной строки и конвертирует конфигурационный файл в формат TOML. Она ожидает один аргумент — путь к входному файлу. Функция открывает указанный файл, читает его содержимое, затем использует объект `ConfigParser` для разбора текста. Результат преобразуется в формат TOML с помощью библиотеки `toml`, после чего выводится на экран. В случае ошибок, таких как синтаксическая ошибка, отсутствие файла или другие непредвиденные ошибки, выводится соответствующее сообщение об ошибке.
### Тест
![Тест](https://raw.githubusercontent.com/juliyurkova/conf_man2/refs/heads/main/capture_20241115122816517.bmp)
